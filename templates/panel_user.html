<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>{{ username }} - Role Assignment (Panel Debug)</title>
Â  Â  
Â  Â  <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
Â  Â  <link rel="stylesheet" href="{{ url_for('static', filename='user.css') }}">
Â  Â  <style>
Â  Â  Â  Â  .role-container {
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  padding: 1.5rem;
Â  Â  Â  Â  Â  Â  max-width: 600px;
Â  Â  Â  Â  Â  Â  margin: 0 auto;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  .username-display {
Â  Â  Â  Â  Â  Â  font-size: 1.5rem;
Â  Â  Â  Â  Â  Â  margin-bottom: 1rem;
Â  Â  Â  Â  Â  Â  color: #6c757d;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  .panel-badge {
Â  Â  Â  Â  Â  Â  background: #28a745;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  padding: 0.3rem 0.8rem;
Â  Â  Â  Â  Â  Â  border-radius: 15px;
Â  Â  Â  Â  Â  Â  font-size: 0.8rem;
Â  Â  Â  Â  Â  Â  margin-left: 1rem;
Â  Â  Â  Â  Â  Â  display: inline-block;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  .role-display {
Â  Â  Â  Â  Â  Â  padding: 1.5rem;
Â  Â  Â  Â  Â  Â  border-radius: 15px;
Â  Â  Â  Â  Â  Â  margin: 1rem 0;
Â  Â  Â  Â  Â  Â  font-size: 2.5rem;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  text-transform: uppercase;
Â  Â  Â  Â  Â  Â  letter-spacing: 2px;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  .role-imposter1, .role-imposter2, .role-imposter3 {
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #dc3545, #8b0000);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  border: 3px solid #dc3545;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  .role-crewmate {
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #0d6efd, #004085);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  border: 3px solid #0d6efd;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  .role-waiting {
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #6c757d, #495057);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  border: 3px solid #6c757d;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  .waiting-message {
Â  Â  Â  Â  Â  Â  font-size: 1rem;
Â  Â  Â  Â  Â  Â  color: #adb5bd;
Â  Â  Â  Â  Â  Â  margin-top: 0.5rem;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  .progress-link {
Â  Â  Â  Â  Â  Â  margin-top: 2rem;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  .auto-refresh {
Â  Â  Â  Â  Â  Â  font-size: 0.9rem;
Â  Â  Â  Â  Â  Â  color: #6c757d;
Â  Â  Â  Â  Â  Â  margin-top: 1rem;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  .players-list {
Â  Â  Â  Â  Â  Â  background: rgba(255, 255, 255, 0.1);
Â  Â  Â  Â  Â  Â  border-radius: 15px;
Â  Â  Â  Â  Â  Â  padding: 1rem;
Â  Â  Â  Â  Â  Â  margin: 1rem 0;
Â  Â  Â  Â  Â  Â  text-align: left;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  .players-title {
Â  Â  Â  Â  Â  Â  font-size: 1.3rem;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  margin-bottom: 1rem;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  color: #0d6efd;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  .player-item {
Â  Â  Â  Â  Â  Â  padding: 0.5rem;
Â  Â  Â  Â  Â  Â  margin: 0.3rem 0;
Â  Â  Â  Â  Â  Â  background: rgba(255, 255, 255, 0.05);
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  .player-name {
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  .player-current {
Â  Â  Â  Â  Â  Â  background: rgba(13, 110, 253, 0.2);
Â  Â  Â  Â  Â  Â  border: 1px solid rgba(13, 110, 253, 0.5);
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  .other-imposters {
Â  Â  Â  Â  Â  Â  background: rgba(220, 53, 69, 0.1);
Â  Â  Â  Â  Â  Â  border: 1px solid rgba(220, 53, 69, 0.3);
Â  Â  Â  Â  Â  Â  border-radius: 10px;
Â  Â  Â  Â  Â  Â  padding: 1rem;
Â  Â  Â  Â  Â  Â  margin-top: 1rem;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  .other-imposters-title {
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  color: #dc3545;
Â  Â  Â  Â  Â  Â  margin-bottom: 0.5rem;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  .tasks-container {
Â  Â  Â  Â  Â  Â  background: rgba(255, 255, 255, 0.1);
Â  Â  Â  Â  Â  Â  border-radius: 15px;
Â  Â  Â  Â  Â  Â  padding: 1.5rem;
Â  Â  Â  Â  Â  Â  margin: 1.5rem 0;
Â  Â  Â  Â  Â  Â  text-align: left;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  .tasks-title {
Â  Â  Â  Â  Â  Â  font-size: 1.4rem;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  margin-bottom: 1rem;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  color: #20c997;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  .task-section {
Â  Â  Â  Â  Â  Â  margin-bottom: 1.5rem;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  .task-section-title {
Â  Â  Â  Â  Â  Â  font-size: 1.1rem;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  margin-bottom: 0.8rem;
Â  Â  Â  Â  Â  Â  color: #ffc107;
Â  Â  Â  Â  Â  Â  border-bottom: 2px solid #ffc107;
Â  Â  Â  Â  Â  Â  padding-bottom: 0.3rem;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  .task-list {
Â  Â  Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  Â  Â  gap: 0.8rem;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  .task-item {
Â  Â  Â  Â  Â  Â  background: rgba(255, 255, 255, 0.05);
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  padding: 0.8rem;
Â  Â  Â  Â  Â  Â  border-left: 4px solid #20c997;
Â  Â  Â  Â  Â  Â  transition: all 0.3s ease;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  .task-item:hover {
Â  Â  Â  Â  Â  Â  background: rgba(255, 255, 255, 0.1);
Â  Â  Â  Â  Â  Â  transform: translateX(5px);
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  .task-name {
Â  Â  Â  Â  Â  Â  color: #e9ecef;
Â  Â  Â  Â  Â  Â  display: block;
Â  Â  Â  Â  Â  Â  font-weight: 500;
Â  Â  Â  Â  Â  Â  cursor: default;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  .task-type {
Â  Â  Â  Â  Â  Â  font-size: 0.8rem;
Â  Â  Â  Â  Â  Â  color: #6c757d;
Â  Â  Â  Â  Â  Â  margin-top: 0.3rem;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  .loading-tasks {
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  color: #6c757d;
Â  Â  Â  Â  Â  Â  font-style: italic;
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>
Â  Â  Â  Â  <div class="container-fluid d-flex align-items-center justify-content-center" style="min-height: 100vh; overflow-y: auto;">
Â  Â  Â  Â  <div class="role-container">
Â  Â  Â  Â  Â  Â  <div class="username-display">
Â  Â  Â  Â  Â  Â  Â  Â  Player: {{ username }}
Â  Â  Â  Â  Â  Â  Â  Â  <span class="panel-badge">PANEL DEBUG</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  
Â  Â  Â  Â  {% if role %}
Â  Â  Â  Â  Â  Â  <div class="role-display role-{{ role.lower() }}">
Â  Â  Â  Â  Â  Â  Â  Â  {{ role }}
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  {% if role.startswith('Imposter') %}
Â  Â  Â  Â  Â  Â  Â  Â  <div class="waiting-message">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ”´ You are an Imposter! Complete fake tasks and eliminate crewmates.
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  {% if other_imposters %}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="other-imposters">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="other-imposters-title">Other Imposters:</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {% for imposter in other_imposters %}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="player-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="player-name">ğŸ”´ {{ imposter }}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {% endfor %}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  {% endif %}
Â  Â  Â  Â  Â  Â  {% else %}
Â  Â  Â  Â  Â  Â  Â  Â  <div class="waiting-message">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ”µ You are a Crewmate! Complete tasks and find the Imposters.
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  {% endif %}
Â  Â  Â  Â  {% else %}
Â  Â  Â  Â  Â  Â  <div class="role-display role-waiting">
Â  Â  Â  Â  Â  Â  Â  Â  Waiting for Role Assignment
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="waiting-message">
Â  Â  Â  Â  Â  Â  Â  Â  Your role will appear here once the game master assigns roles.
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="players-list">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="players-title">Players in Game</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="playersList">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Loading players...
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  <div class="auto-refresh">
Â  Â  Â  Â  Â  Â  Â  Â  This page will refresh automatically every 3 seconds.
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  {% endif %}
Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  {% if role %}
Â  Â  Â  Â  <div class="tasks-container" id="tasksContainer">
Â  Â  Â  Â  Â  Â  {% if role.startswith('Imposter') %}
Â  Â  Â  Â  Â  Â  <div class="alert alert-warning" style="background: rgba(220, 53, 69, 0.1); border: 1px solid rgba(220, 53, 69, 0.3); color: #dc3545; margin-bottom: 1rem; padding: 1rem; border-radius: 10px;">
Â  Â  Â  Â  Â  Â  Â  Â  <strong>ğŸ­ Fake Tasks</strong><br>
Â  Â  Â  Â  Â  Â  Â  Â  These are fake tasks for you as an Imposter. Completing them will show on the admin panel but <strong>will NOT contribute to the progress bar</strong>. Use them to blend in with crewmates!
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  {% endif %}
Â  Â  Â  Â  Â  Â  <div class="tasks-title">ğŸ“‹ Your Assigned Tasks</div>
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  <div class="task-section">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="task-section-title">ğŸŒ Global Tasks (Everyone)</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="task-list" id="globalTasksList">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="loading-tasks">Loading global tasks...</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  <div class="task-section">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="task-section-title">ğŸ‘¤ Individual Tasks (You Only)</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="task-list" id="individualTasksList">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="loading-tasks">Loading individual tasks...</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  {% endif %}
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <script>
Â  Â  Â  Â  const username = "{{ username }}";
Â  Â  Â  Â  const initialResetTime = {{ reset_time }};
Â  Â  Â  Â  let lastKnownResetTime = initialResetTime;
Â  Â  Â  Â  
Â  Â  Â  Â  {% if role %}
Â  Â  Â  Â  // Save role to localStorage when assigned (for consistency)
Â  Â  Â  Â  localStorage.setItem('gameRole', "{{ role }}");
Â  Â  Â  Â  {% endif %}
Â  Â  Â  Â  
Â  Â  Â  Â  // Check if roles have been reset
Â  Â  Â  Â  function checkRoleReset() {
Â  Â  Â  Â  Â  Â  fetch('/api/reset-status')
Â  Â  Â  Â  Â  Â  Â  Â  .then(response => response.json())
Â  Â  Â  Â  Â  Â  Â  Â  .then(data => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (data.success && data.last_reset_time > lastKnownResetTime) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Roles have been reset - reload
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  location.reload();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  .catch(error => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Silent error handling
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  // Check for role reset every 2 seconds
Â  Â  Â  Â  setInterval(checkRoleReset, 2000);
Â  Â  Â  Â  
Â  Â  Â  Â  // Load user tasks if role is assigned
Â  Â  Â  Â  {% if role %}
Â  Â  Â  Â  function loadUserTasks() {
Â  Â  Â  Â  Â  Â  fetch('/api/user-tasks')
Â  Â  Â  Â  Â  Â  Â  Â  .then(response => response.json())
Â  Â  Â  Â  Â  Â  Â  Â  .then(data => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (data.success) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Display global tasks
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const globalTasksList = document.getElementById('globalTasksList');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (data.global_tasks && data.global_tasks.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  globalTasksList.innerHTML = data.global_tasks.map(task => 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `<div class="task-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="task-name">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${task.name}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="task-type">Task ${task.id}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ).join('');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  globalTasksList.innerHTML = '<div class="loading-tasks">No global tasks assigned yet</div>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Display individual tasks
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const individualTasksList = document.getElementById('individualTasksList');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (data.individual_tasks && data.individual_tasks.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  individualTasksList.innerHTML = data.individual_tasks.map(task => 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `<div class="task-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="task-name">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${task.name}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="task-type">Task ${task.id}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ).join('');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  individualTasksList.innerHTML = '<div class="loading-tasks">No individual tasks assigned yet</div>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('globalTasksList').innerHTML = '<div class="loading-tasks">Error loading tasks</div>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('individualTasksList').innerHTML = '<div class="loading-tasks">Error loading tasks</div>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  .catch(error => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('globalTasksList').innerHTML = '<div class="loading-tasks">Error loading tasks</div>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('individualTasksList').innerHTML = '<div class="loading-tasks">Error loading tasks</div>';
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  // Load tasks when page loads
Â  Â  Â  Â  loadUserTasks();
Â  Â  Â  Â  
Â  Â  Â  Â  // Refresh tasks every 5 seconds
Â  Â  Â  Â  setInterval(loadUserTasks, 5000);
Â  Â  Â  Â  {% endif %}
Â  Â  Â  Â  
Â  Â  Â  Â  // Heartbeat function to keep user active
Â  Â  Â  Â  function sendHeartbeat() {
Â  Â  Â  Â  Â  Â  fetch('/api/ping', {
Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  headers: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Content-Type': 'application/json',
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify({ username: username })
Â  Â  Â  Â  Â  Â  }).then(response => {
Â  Â  Â  Â  Â  Â  Â  Â  // If user has been kicked, redirect to join page
Â  Â  Â  Â  Â  Â  Â  Â  if (response.status === 403) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.location.href = '/join?kicked=1';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }).catch(error => {
Â  Â  Â  Â  Â  Â  Â  Â  // Silent error handling for heartbeat
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  // Send heartbeat every 8 seconds (well under the 25 second server timeout)
Â  Â  Â  Â  setInterval(sendHeartbeat, 8000);
Â  Â  Â  Â  
Â  Â  Â  Â  // Send initial heartbeat
Â  Â  Â  Â  sendHeartbeat();
Â  Â  Â  Â  
Â  Â  Â  Â  // Clear cookies when tab/window is closed (before roles assigned)
Â  Â  Â  Â  window.addEventListener('beforeunload', function() {
Â  Â  Â  Â  Â  Â  {% if not role %}
Â  Â  Â  Â  Â  Â  // Only clear if no role assigned yet
Â  Â  Â  Â  Â  Â  localStorage.removeItem('gameUsername');
Â  Â  Â  Â  Â  Â  localStorage.removeItem('gameRole');
Â  Â  Â  Â  Â  Â  {% endif %}
Â  Â  Â  Â  });
Â  Â  Â  Â  
Â  Â  Â  Â  // Function to update players list
Â  Â  Â  Â  function updatePlayersList() {
Â  Â  Â  Â  Â  Â  fetch('/api/players')
Â  Â  Â  Â  Â  Â  Â  Â  .then(response => response.json())
Â  Â  Â  Â  Â  Â  Â  Â  .then(data => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (data.success) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const playersListDiv = document.getElementById('playersList');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (playersListDiv) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let html = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data.players.forEach(player => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isCurrentUser = player === username;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const playerClass = isCurrentUser ? 'player-item player-current' : 'player-item';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const playerIcon = isCurrentUser ? 'ğŸ‘¤' : 'ğŸ®';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html += `<div class="${playerClass}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="player-name">${playerIcon} ${player}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${isCurrentUser ? ' (You)' : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (html === '') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html = '<div class="player-item">No players found</div>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  playersListDiv.innerHTML = html;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  .catch(error => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Silent error handling
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  // Update players list initially and every 2 seconds if no role assigned
Â  Â  Â  Â  {% if not role %}
Â  Â  Â  Â  updatePlayersList();
Â  Â  Â  Â  setInterval(updatePlayersList, 2000);
Â  Â  Â  Â  
Â  Â  Â  Â  // Auto-refresh every 3 seconds if no role is assigned
Â  Â  Â  Â  setTimeout(function() {
Â  Â  Â  Â  Â  Â  location.reload();
Â  Â  Â  Â  }, 3000);
Â  Â  Â  Â  {% endif %}
Â  Â  </script>

Â  Â  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>